<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chestnut Statemachine: door_statemachine.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Chestnut Statemachine
   &#160;<span id="projectnumber">v3.0.0</span>
   </div>
   <div id="projectbrief">A C++ header-only library for finite statemachine implementation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('door_statemachine_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">door_statemachine.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>A source file with door statemachine example </p><dl class="section author"><dt>Author</dt><dd>Przemys≈Çaw Cedro (SpontanCombust) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>3.0.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2022-01-20</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>MIT License (c) 2021-2022</dd></dl>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ================= 0. (Optional) For convenience include fsm.hpp and do a &#39;using&#39; on namespace ====================</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 0.1</span></div>
<div class="line"><span class="comment">// fsm.hpp includes all other headers mentioned below</span></div>
<div class="line"><span class="preprocessor">#include &lt;chestnut/fsm/fsm.hpp&gt;</span></div>
<div class="line"><span class="comment">// 0.2</span></div>
<div class="line"><span class="comment">// Writing this long two-part namespace every time can be annoying :) </span></div>
<div class="line"><span class="keyword">using namespace </span>chestnut::fsm; </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// ====================================== 1. Define your statemachine type ============================================</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 1.1. (Optional)</span></div>
<div class="line"><span class="comment">// Create a state extension class.</span></div>
<div class="line"><span class="comment">// By default a statemachine class has access only to the very basic state methods like canEnterState.</span></div>
<div class="line"><span class="comment">// States will still be able to transition between each other, the statemachine class will simply not be able to interact with them in any more custom manner.</span></div>
<div class="line"><span class="comment">// An extension class will allow you to use more than these basic methods and set up a way to communicate with states.</span></div>
<div class="line"><span class="comment">// Extension can have pure virtual methods for example so that states will actually be forced to implement them.</span></div>
<div class="line"><span class="comment">// By creating a statemachine with state extension you will be able to call public methods of that extension on states</span></div>
<div class="line"><span class="keyword">class </span>DoorStateExtension</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> tryOpen() = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> tryClose() = 0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// 1.2. (IMPORTANT!)</span></div>
<div class="line"><span class="comment">// A thing or two about cyclic dependency:</span></div>
<div class="line"><span class="comment">// All state change methods like gotoState() or initState() take state type name as the template parameter. This and also the fact that </span></div>
<div class="line"><span class="comment">// underneath a instance of this class is created means that the type you give to these methods has to be a *complete type*. </span></div>
<div class="line"><span class="comment">// What this in turn means is that there has to be a declaration of said type before its usage and somewhere in an entire translation unit where it happens</span></div>
<div class="line"><span class="comment">// there has to be a body of this state type. To avoid the issue of cyclic header inclusion you can use forward class declaration as shown above. </span></div>
<div class="line"><span class="comment">// This is C++ and this is a thing we all have to remember and deal with unfortunatelly. </span></div>
<div class="line"><span class="comment">// More on incomplete types: https://en.cppreference.com/w/cpp/language/type#Incomplete_type</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// For this reason, because we will want to use CDoorStateClosed below here to initialize the statemachine we will forward declare its type.</span></div>
<div class="line"><span class="comment">// You will see more examples of such action further below.</span></div>
<div class="line"><span class="keyword">class </span>CDoorStateClosed; <span class="comment">// forward declaration because of usage in CDoorStatemachine::CDoorStatemachine()</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// 1.3. </span></div>
<div class="line"><span class="comment">// To create a custom statemachine class include statemachine.hpp header</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="statemachine_8hpp.html">chestnut/fsm/statemachine.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...If you decided to use a state extension class, in the template parameter of chestnut::fsm::Statemachine</span></div>
<div class="line"><span class="comment">// input this type. Otherwise you can just write chestnut::fsm::Statemachine&lt;&gt; for a basic setup</span></div>
<div class="line"><span class="keyword">class </span>CDoorStatemachine : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="classchestnut_1_1fsm_1_1_statemachine.html">Statemachine</a>&lt;DoorStateExtension&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// 1.4. (Optional) </span></div>
<div class="line">    <span class="comment">// You can make your statemachine able to be used across threads in an async manner</span></div>
<div class="line">    <span class="comment">// The base Statemachine type does not support multithreading, so you&#39;ll have to set up the necessary precautions yourself</span></div>
<div class="line">    <span class="keyword">mutable</span> std::mutex doorMutex;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    CDoorStatemachine()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 1.5. </span></div>
<div class="line">        <span class="comment">// A statemachine has to be initialized with some entry state</span></div>
<div class="line">        <span class="comment">// This state will stay on the state stack throughout the lifetime of the statemachine and won&#39;t be possible to get poppped</span></div>
<div class="line">        <span class="comment">// If you don&#39;t have a state that could be good candidate for a state that the machine should always eventually transition back to</span></div>
<div class="line">        <span class="comment">// you can simply create an empty state! Just inherit from the base state type and that&#39;s it. </span></div>
<div class="line">        <span class="comment">// State does not force you to override any pure virtual methods or create any special constructors.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// 1.6. (Optional) </span></div>
<div class="line">        <span class="comment">// We can call state transition method with custom parameters. These parameters will be forwarded to state&#39;s constructor. See point 3.3.</span></div>
<div class="line">        <span class="comment">// Calling initState() inside a constructor ensures it will always be initialised with this state</span></div>
<div class="line">        initState&lt;CDoorStateClosed&gt;( <span class="keyword">true</span> );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 1.7. (Optional) If you want you can create methods in the statemachine with the same signatures that you gave in point 1.1</span></div>
<div class="line">    <span class="comment">// This will make them look as a sort of &quot;state-virtual&quot; methods, </span></div>
<div class="line">    <span class="comment">// i.e. methods which behaviour depends almost solely on the current state of the statemachine</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> tryOpen()</div>
<div class="line">    {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; lock( doorMutex );</div>
<div class="line">        <span class="keywordflow">return</span> getCurrentState()-&gt;tryOpen();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> tryClose()</div>
<div class="line">    {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; lock( doorMutex );</div>
<div class="line">        <span class="keywordflow">return</span> getCurrentState()-&gt;tryClose();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// ====================================== 2. Define your states ======================================</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 2.1</span></div>
<div class="line"><span class="comment">// To create a state class first include state.hpp header</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="state_8hpp.html">chestnut/fsm/state.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CDoorStateOpening; <span class="comment">// forward declaration because of usage in CDoorStateClosed::tryOpen()</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...then inherit from chestnut::fsm::State </span></div>
<div class="line"><span class="comment">// for the template parameter give it the type of the statemachine you created</span></div>
<div class="line"><span class="comment">// The base state type will be deduced from a typedef inside the statemachine class</span></div>
<div class="line"><span class="keyword">class </span>CDoorStateClosed : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classchestnut_1_1fsm_1_1_state.html">State</a>&lt;CDoorStatemachine&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// 2.2. (Optional) </span></div>
<div class="line">    <span class="comment">// States can have a custom constructor or just a default one</span></div>
<div class="line">    <span class="comment">// You pass these custom parameters when you call initState(), gotoState() or pushState()</span></div>
<div class="line">    CDoorStateClosed( <span class="keywordtype">bool</span> printOnNullState = <span class="keyword">false</span> )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 2.3. </span></div>
<div class="line">        <span class="comment">// Inside a state constructor you shouldn&#39;t use the getParent() method, because the pointer to the parent statemachine has not been set up by this point</span></div>
<div class="line">        <span class="comment">// Calling it here will throw BadParentAccessException</span></div>
<div class="line">        <span class="comment">// If you want to use the parent statemchine do it in onEnterState and onLeaveState methods instead</span></div>
<div class="line">        this-&gt;printOnNullState = printOnNullState;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2.4. (Optional) </span></div>
<div class="line">    <span class="comment">// Override methods that will be called when a statemachine enter or leaves the state</span></div>
<div class="line">    <span class="comment">// The data about the transition (whether it was done with popState() method for example) is in StateTransition struct in the parameter</span></div>
<div class="line">    <span class="comment">// You are not obligated to override these methods however</span></div>
<div class="line">    <span class="keywordtype">void</span> onEnterState( <a name="_a2"></a><a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// message won&#39;t show if this is the init state</span></div>
<div class="line">        <span class="keywordflow">if</span>( transition.<a name="a3"></a><a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html#aef8ec0adf0b9b6a46f3fec39e5ad5c89">type</a> != <a name="a4"></a>STATE_TRANSITION_INIT )</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;The door is now closed!\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( printOnNullState )</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;CDoorStateClosed is the init state!\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onLeaveState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// message won&#39;t show if statemachine is being deleted</span></div>
<div class="line">        <span class="keywordflow">if</span>( transition.<a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html#aef8ec0adf0b9b6a46f3fec39e5ad5c89">type</a> != <a name="a5"></a>STATE_TRANSITION_DESTROY )</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;The door is no longer closed!\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( printOnNullState )</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Statemachine is being destroyed!\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 2.5. (Optional) </span></div>
<div class="line">    <span class="comment">// Override the virtual methods you specified in point 1.1</span></div>
<div class="line">    <span class="keywordtype">bool</span> tryOpen()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// State change methods work based on state stack</span></div>
<div class="line">        <span class="comment">// initState initializes the state stack</span></div>
<div class="line">        <span class="comment">// pushState pushes a new state onto a stack and transitions into it</span></div>
<div class="line">        <span class="comment">// popState pops a state from the top of a stack and transitions to the one below</span></div>
<div class="line">        <span class="comment">// gotoState replaces the state on top of the stack by transitioning to the new state directly</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// There is an exception to these rules above - that is the initial state.</span></div>
<div class="line">        <span class="comment">// Init state cannot be popped and if you call a gotoState on a statemachine with only the init state it will behave like pushState</span></div>
<div class="line">        getParent().pushState&lt;CDoorStateOpening&gt;();</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> tryClose()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door is already closed!\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">bool</span> printOnNullState;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CDoorStateOpen; <span class="comment">// forward declaration because of usage in CDoorStateOpening::onEnterState()</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CDoorStateOpening : <span class="keyword">public</span> <a class="code" href="classchestnut_1_1fsm_1_1_state.html">State</a>&lt;CDoorStatemachine&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// 2.6. </span></div>
<div class="line">    <span class="comment">// You don&#39;t even need to define a constructor at all if you don&#39;t need to!</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onEnterState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door is openning...\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// spawn a thread that&#39;ll wait 2 seconds and then transition to next state</span></div>
<div class="line">        std::thread( [<span class="keyword">this</span>] {</div>
<div class="line">            std::this_thread::sleep_for( std::chrono::seconds(2) );</div>
<div class="line">            <span class="comment">// we&#39;re in a different thread, we have to lock the parent</span></div>
<div class="line">            std::lock_guard&lt;std::mutex&gt; lock( getParent().doorMutex );</div>
<div class="line">            getParent().gotoState&lt;CDoorStateOpen&gt;();</div>
<div class="line">        }).detach();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onLeaveState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door has finished openning!\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> tryOpen()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door is already in the process of openning!\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> tryClose()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;I&#39;m sorry. I first need to finish opening.\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CDoorStateClosing; <span class="comment">// forward declaration because of usage in CDoorStateOpen::tryClose()</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CDoorStateOpen : <span class="keyword">public</span> <a class="code" href="classchestnut_1_1fsm_1_1_state.html">State</a>&lt;CDoorStatemachine&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> onEnterState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// message won&#39;t show if this is the init state</span></div>
<div class="line">        <span class="keywordflow">if</span>( transition.<a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html#aef8ec0adf0b9b6a46f3fec39e5ad5c89">type</a> != STATE_TRANSITION_INIT )</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;The door is now open!\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onLeaveState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// message won&#39;t show if statemachine is being deleted</span></div>
<div class="line">        <span class="keywordflow">if</span>( transition.<a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html#aef8ec0adf0b9b6a46f3fec39e5ad5c89">type</a> != STATE_TRANSITION_DESTROY )</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;The door is no longer open!\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> tryOpen()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door is already open!\n&quot;</span>;     </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> tryClose()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        getParent().gotoState&lt;CDoorStateClosing&gt;();</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CDoorStateClosing : <span class="keyword">public</span> <a class="code" href="classchestnut_1_1fsm_1_1_state.html">State</a>&lt;CDoorStatemachine&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> onEnterState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door is closing...\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        std::thread( [<span class="keyword">this</span>] {</div>
<div class="line">            std::this_thread::sleep_for( std::chrono::seconds(2) );</div>
<div class="line">            <span class="comment">// we&#39;re in a different thread, we have to lock the parent</span></div>
<div class="line">            std::lock_guard&lt;std::mutex&gt; lock( getParent().doorMutex );</div>
<div class="line">            getParent().popState();</div>
<div class="line">        }).detach();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onLeaveState( <a class="code" href="structchestnut_1_1fsm_1_1_state_transition.html">StateTransition</a> transition )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door has finished closing!\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> tryOpen()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;I&#39;m sorry. I first need to finish closing.\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> tryClose()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The door is already in the process of closing!\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// ===================== 3. Use your statemachine object =====================</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *doorStateTypeToString( std::type_index type )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>( type == <span class="keyword">typeid</span>(CDoorStateOpen ) )</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Open&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( type == <span class="keyword">typeid</span>(CDoorStateOpening ) )</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Opening&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( type == <span class="keyword">typeid</span>(CDoorStateClosed ) )</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Closed&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( type == <span class="keyword">typeid</span>(CDoorStateClosing ) )</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Closing&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    CDoorStatemachine door;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> printDoorState = [&amp;door] {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Door state: &quot;</span> &lt;&lt; doorStateTypeToString( door.getCurrentStateType() ) &lt;&lt; <span class="stringliteral">&quot;; state stack size: &quot;</span> &lt;&lt; door.getStateStackSize() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    printDoorState();</div>
<div class="line">    <span class="keywordflow">if</span>( door.tryClose() )</div>
<div class="line">    {</div>
<div class="line">        printDoorState();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( door.tryOpen() )</div>
<div class="line">    {</div>
<div class="line">        printDoorState();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span>( door.isCurrentlyInState&lt;CDoorStateOpening&gt;() )</div>
<div class="line">        {</div>
<div class="line">            std::this_thread::sleep_for( std::chrono::milliseconds(100) ); <span class="comment">// we&#39;ll keep waiting small intervals until the door fully opens</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printDoorState();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>( door.tryClose() )</div>
<div class="line">        {</div>
<div class="line">            printDoorState();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">while</span>( door.isCurrentlyInState&lt;CDoorStateClosing&gt;() )</div>
<div class="line">            {</div>
<div class="line">                std::this_thread::sleep_for( std::chrono::milliseconds(100) );</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            printDoorState();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* CONSOLE OUTPUT</span></div>
<div class="line"><span class="comment">CDoorStateClosed is the init state!</span></div>
<div class="line"><span class="comment">Door state: Closed; state stack size: 1</span></div>
<div class="line"><span class="comment">The door is already closed!</span></div>
<div class="line"><span class="comment">The door is no longer closed!</span></div>
<div class="line"><span class="comment">The door is openning...</span></div>
<div class="line"><span class="comment">Door state: Opening; state stack size: 2</span></div>
<div class="line"><span class="comment">The door has finished openning!</span></div>
<div class="line"><span class="comment">The door is now open!</span></div>
<div class="line"><span class="comment">Door state: Open; state stack size: 2</span></div>
<div class="line"><span class="comment">The door is no longer open!</span></div>
<div class="line"><span class="comment">The door is closing...</span></div>
<div class="line"><span class="comment">Door state: Closing; state stack size: 2</span></div>
<div class="line"><span class="comment">The door has finished closing!</span></div>
<div class="line"><span class="comment">The door is now closed!</span></div>
<div class="line"><span class="comment">Door state: Closed; state stack size: 1</span></div>
<div class="line"><span class="comment">Statemachine is being destroyed!</span></div>
<div class="line"><span class="comment">*/</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astatemachine_8hpp_html"><div class="ttname"><a href="statemachine_8hpp.html">statemachine.hpp</a></div><div class="ttdoc">Header file with the template Statemachine class.</div></div>
<div class="ttc" id="aclasschestnut_1_1fsm_1_1_statemachine_html"><div class="ttname"><a href="classchestnut_1_1fsm_1_1_statemachine.html">chestnut::fsm::Statemachine</a></div><div class="ttdoc">Template statemachine class. Inherit from this type to create a proper statemachine class.</div><div class="ttdef"><b>Definition:</b> statemachine.hpp:37</div></div>
<div class="ttc" id="astructchestnut_1_1fsm_1_1_state_transition_html_aef8ec0adf0b9b6a46f3fec39e5ad5c89"><div class="ttname"><a href="structchestnut_1_1fsm_1_1_state_transition.html#aef8ec0adf0b9b6a46f3fec39e5ad5c89">chestnut::fsm::StateTransition::type</a></div><div class="ttdeci">EStateTransitionType type</div><div class="ttdef"><b>Definition:</b> state_transition.hpp:56</div></div>
<div class="ttc" id="astructchestnut_1_1fsm_1_1_state_transition_html"><div class="ttname"><a href="structchestnut_1_1fsm_1_1_state_transition.html">chestnut::fsm::StateTransition</a></div><div class="ttdoc">Struct containing data describing a state transition.</div><div class="ttdef"><b>Definition:</b> state_transition.hpp:53</div></div>
<div class="ttc" id="astate_8hpp_html"><div class="ttname"><a href="state_8hpp.html">state.hpp</a></div><div class="ttdoc">Header file with the template State class.</div></div>
<div class="ttc" id="aclasschestnut_1_1fsm_1_1_state_html"><div class="ttname"><a href="classchestnut_1_1fsm_1_1_state.html">chestnut::fsm::State</a></div><div class="ttdoc">Template state class. Inherit from this class to create a proper state class.</div><div class="ttdef"><b>Definition:</b> state.hpp:36</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
